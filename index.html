<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Candle Drill - Zoom Edition</title>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏±‡∏ö‡∏Å‡∏ß‡∏ô‡πÉ‡∏à */
    body { 
        background: #222; margin: 0; padding: 0; 
        font-family: 'Sarabun', sans-serif; 
        overflow: hidden; /* ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
        width: 100vw; 
        height: 100vh; height: 100dvh; /* ‡πÅ‡∏Å‡πâ Safari ‡∏ö‡∏±‡∏á */
        display: flex; flex-direction: column; 
        touch-action: none; /* ‡∏´‡πâ‡∏≤‡∏° Browser ‡∏°‡∏≤‡∏¢‡∏∏‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™ */
    }
    
    #game-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; position: relative; }
    
    /* 2. ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≤‡∏ü (‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ) */
    #game-container { 
        flex: 1; 
        width: 100%; 
        background: #333; 
        overflow: auto; /* ‚úÖ ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ Scroll ‡πÑ‡∏î‡πâ */
        display: flex; 
        align-items: center; /* ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
        justify-content: flex-start; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠ */
        -webkit-overflow-scrolling: touch; /* ‡∏•‡∏∑‡πà‡∏ô‡πÜ ‡πÅ‡∏ö‡∏ö iOS */
        touch-action: pan-x pan-y; /* ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏õ‡∏±‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
        padding-bottom: 150px; /* ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á */
    }
    
    /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏≤‡∏ü */
    #chart-box { position: relative; transition: width 0.1s; /* ‡∏ã‡∏π‡∏°‡∏™‡∏°‡∏π‡∏ó‡πÜ */ }
    img.quiz-bg { display: block; height: 100%; width: 100%; pointer-events: none; }
    canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; touch-action: none; }

    /* 3. ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏•‡∏≠‡∏¢ (Floating Control) */
    #control-area { 
        position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
        width: 90%; max-width: 450px;
        background: rgba(30,35,41,0.95); backdrop-filter: blur(10px);
        border: 1px solid #fcd535; border-radius: 20px;
        padding: 15px; z-index: 100;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        display: flex; flex-direction: column; align-items: center; gap: 10px;
    }

    .question-text { 
        font-size: 16px; font-weight: bold; color: #fff; 
        margin: 0; text-align: center; text-shadow: 0 1px 2px black;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç */
    #choice-container { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
    .choice-btn {
        width: 45px; height: 45px;
        background: #333; color: #fcd535;
        border: 2px solid #fcd535; border-radius: 50%;
        font-size: 18px; font-weight: bold; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        transition: 0.2s;
    }
    .choice-btn:active { transform: scale(0.9); background: #fcd535; color: #000; }
    
    /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏π‡∏Å‡∏ú‡∏¥‡∏î */
    .btn-correct { background: #28a745 !important; color: white !important; border-color: #28a745 !important; }
    .btn-wrong { background: #dc3545 !important; color: white !important; border-color: #dc3545 !important; opacity: 0.5; }

    /* 4. ‡πÅ‡∏ñ‡∏ö‡∏ã‡∏π‡∏° (Zoom Slider) */
    .zoom-controls {
        display: flex; align-items: center; gap: 10px; width: 100%; margin-top: 5px;
        padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);
    }
    .zoom-icon { font-size: 14px; color: #888; }
    input[type=range] {
        flex: 1; -webkit-appearance: none; height: 4px; background: #555; border-radius: 2px;
    }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none; width: 20px; height: 20px; 
        background: #fcd535; border-radius: 50%; cursor: pointer;
    }

    /* Modal ‡∏à‡∏ö‡πÄ‡∏Å‡∏° */
    #end-screen {
        display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 9999;
        flex-direction: column; align-items: center; justify-content: center; color: white;
    }
  </style>
</head>
<body>

<div id="game-wrapper">
  <div id="game-container">
    <div id="chart-box">
        <img src="" class="quiz-bg" id="bgImage">
        <canvas id="quizCanvas"></canvas>
    </div>
  </div>

  <div id="control-area">
    <div id="questionText" class="question-text">Loading...</div>
    
    <div id="choice-container">
        </div>

    <div class="zoom-controls">
        <span class="zoom-icon">üîç -</span>
        <input type="range" id="zoomSlider" min="1" max="3" step="0.1" value="1" oninput="updateZoom(this.value)">
        <span class="zoom-icon">üîç +</span>
    </div>
  </div>
</div>

<div id="end-screen">
    <h1>üéâ ‡∏à‡∏ö‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î!</h1>
    <button onclick="location.href='dashboard.html'" style="padding:10px 20px; font-size:18px; border-radius:50px; cursor:pointer;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
</div>

<script>
// ==========================================
// 1. üìÇ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏à‡∏ó‡∏¢‡πå
// ==========================================
const steps = [
  {
    "image": "candle1.png", 
    "question": "‡∏à‡∏≤‡∏Å STO OB ‡πÇ‡∏ã‡∏ô‡∏™‡∏µ‡∏™‡πâ‡∏° ‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß",
    "choices": [
       { "x": 1137, "y": 171, "w": 14, "h": 38 },
       { "x": 1146, "y": 160, "w": 15, "h": 29 },
       { "x": 1159, "y": 166, "w": 15, "h": 48 },
       { "x": 1168, "y": 200, "w": 16, "h": 41 }
    ],
    "correctIndex": 3  
  }
];

// ==========================================
// 2. ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏° + ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡∏π‡∏°
// ==========================================
const canvas = document.getElementById('quizCanvas');
const ctx = canvas.getContext('2d');
const bgImage = document.getElementById('bgImage');
const chartBox = document.getElementById('chart-box');
const gameContainer = document.getElementById('game-container');
const choiceContainer = document.getElementById('choice-container');
const zoomSlider = document.getElementById('zoomSlider');

let currentStepIdx = 0;
let currentZoom = 1; // ‡∏Ñ‡πà‡∏≤‡∏ã‡∏π‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
let baseScale = 1;   // ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏≤‡∏û‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô

window.onload = function() {
    loadStep();
    window.addEventListener('resize', () => { applyZoom(); });
};

function loadStep() {
    if(currentStepIdx >= steps.length) {
        document.getElementById('end-screen').style.display = 'flex';
        return;
    }
    const s = steps[currentStepIdx];
    document.getElementById('questionText').innerText = `‡∏Ç‡πâ‡∏≠ ${currentStepIdx + 1}: ${s.question}`;
    
    choiceContainer.innerHTML = "";
    s.choices.forEach((_, index) => {
        const btn = document.createElement("div");
        btn.className = "choice-btn";
        btn.innerText = index + 1;
        btn.onclick = () => checkAnswer(index, btn);
        choiceContainer.appendChild(btn);
    });

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ã‡∏π‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà
    currentZoom = 1;
    zoomSlider.value = 1;

    bgImage.src = s.image;
    bgImage.onload = function() { 
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Base Scale (‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠‡∏û‡∏≠‡∏î‡∏µ‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å)
        calculateBaseScale();
        applyZoom(); 
    }
}

function calculateBaseScale() {
    if(!bgImage.src) return;
    const containerW = gameContainer.clientWidth;
    const containerH = gameContainer.clientHeight;
    
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏†‡∏≤‡∏û "‡∏û‡∏≠‡∏î‡∏µ‡∏à‡∏≠" (Contain) ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    const ratioW = containerW / bgImage.naturalWidth;
    const ratioH = containerH / bgImage.naturalHeight;
    baseScale = Math.min(ratioW, ratioH);
}

function updateZoom(val) {
    currentZoom = parseFloat(val);
    applyZoom();
}

function applyZoom() {
    if(!bgImage.src) return;
    
    // ‡∏™‡∏π‡∏ï‡∏£: ‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á = Base Scale * Zoom Factor
    const finalScale = baseScale * currentZoom;
    
    const finalW = bgImage.naturalWidth * finalScale;
    const finalH = bgImage.naturalHeight * finalScale;
    
    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á (‡∏ñ‡πâ‡∏≤‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏≠ Scrollbar ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏≠‡∏á)
    chartBox.style.width = finalW + 'px';
    chartBox.style.height = finalH + 'px';
    
    // Canvas ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î)
    canvas.width = bgImage.naturalWidth;
    canvas.height = bgImage.naturalHeight;
    
    draw();
}

// ==========================================
// üé® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ (V6: ‡∏£‡∏∏‡πà‡∏ô‡∏Ñ‡∏≠‡∏¢‡∏≤‡∏ß)
// ==========================================
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const s = steps[currentStepIdx];

    s.choices.forEach((box, index) => {
        const centerX = box.x + (box.w / 2);
        const isTop = (index % 2 === 0); 
        const gap = isTop ? 50 : 35; 
        
        let pinY, targetY; 
        if (isTop) {
            targetY = box.y; 
            pinY = targetY - gap;
        } else {
            targetY = box.y + box.h;
            pinY = targetY + gap;
        }

        ctx.beginPath();
        ctx.moveTo(centerX, pinY);   
        ctx.lineTo(centerX, targetY); 
        ctx.lineWidth = 1.5; ctx.strokeStyle = "#fcd535"; ctx.stroke();

        ctx.beginPath();
        ctx.arc(centerX, pinY, 11, 0, 2 * Math.PI); 
        ctx.fillStyle = "#1e2329"; ctx.fill();
        
        ctx.lineWidth = 1.5; ctx.strokeStyle = "#fcd535"; ctx.stroke();

        ctx.fillStyle = "#fcd535"; ctx.font = "bold 13px Arial"; 
        ctx.textAlign = "center"; ctx.textBaseline = "middle";
        ctx.fillText(index + 1, centerX, pinY + 1); 
    });
}

function checkAnswer(selectedIndex, btnElement) {
    const s = steps[currentStepIdx];
    if(selectedIndex === s.correctIndex) {
        btnElement.classList.add("btn-correct");
        setTimeout(() => { currentStepIdx++; loadStep(); }, 800);
    } else {
        btnElement.classList.add("btn-wrong");
    }
}
</script>
</body>
</html>
