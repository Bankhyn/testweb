<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Candle Drill - Select Number</title>
  <style>
    body { background: #222; margin: 0; padding: 0; font-family: 'Sarabun', sans-serif; overflow: hidden; width: 100vw; height: 100vh; display: flex; flex-direction: column; }
    
    #game-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
    
    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≤‡∏ü */
    #game-container { position: relative; width: 100%; flex: 1; background: #333; overflow: hidden; display: flex; justify-content: center; align-items: center; }
    #chart-box { position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    img.quiz-bg { display: block; width: 100%; height: 100%; }
    canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; touch-action: none; }

    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° */
    #control-area { 
        width: 100%; height: auto; min-height: 100px; 
        background: #f8f9fa; border-top: 1px solid #444; 
        display: flex; flex-direction: column; 
        align-items: center; justify-content: center; 
        padding: 10px; box-sizing: border-box; z-index: 100;
    }

    .question-text { 
        font-size: 16px; font-weight: bold; color: #333; 
        margin-bottom: 10px; text-align: center;
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç */
    #choice-container {
        display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;
    }
    .choice-btn {
        width: 50px; height: 50px;
        background: #333; color: #fcd535;
        border: 2px solid #fcd535; border-radius: 50%;
        font-size: 20px; font-weight: bold; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
        transition: 0.2s;
    }
    .choice-btn:active { transform: scale(0.9); background: #fcd535; color: #000; }
    
    /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡∏π‡∏Å‡∏ú‡∏¥‡∏î */
    .btn-correct { background: #28a745 !important; color: white !important; border-color: #28a745 !important; }
    .btn-wrong { background: #dc3545 !important; color: white !important; border-color: #dc3545 !important; opacity: 0.5; }

    /* Modal ‡∏à‡∏ö‡πÄ‡∏Å‡∏° */
    #end-screen {
        display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); z-index: 9999;
        flex-direction: column; align-items: center; justify-content: center; color: white;
    }
  </style>
</head>
<body>

<div id="game-wrapper">
  <div id="game-container">
    <div id="chart-box">
        <img src="" class="quiz-bg" id="bgImage">
        <canvas id="quizCanvas"></canvas>
    </div>
  </div>

  <div id="control-area">
    <div id="questionText" class="question-text">Loading...</div>
    <div id="choice-container">
        </div>
  </div>
</div>

<div id="end-screen">
    <h1>üéâ ‡∏à‡∏ö‡πÅ‡∏ö‡∏ö‡∏ù‡∏∂‡∏Å‡∏´‡∏±‡∏î!</h1>
    <button onclick="location.href='dashboard.html'" style="padding:10px 20px; font-size:18px; border-radius:50px; cursor:pointer;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
</div>

<script>
// ==========================================
// 1. üìÇ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏à‡∏ó‡∏¢‡πå (‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö)
// ==========================================
const steps = [
  // --- ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà 1 ---
  {
    "image": "candle1.png", 
    "question": "‡∏à‡∏≤‡∏Å STO OB ‡πÇ‡∏ã‡∏ô‡∏™‡∏µ‡∏™‡πâ‡∏° ‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß",
    "choices": [
       // ‡∏ú‡∏°‡πÅ‡∏Å‡∏∞‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏™‡πâ‡πÉ‡∏ô (x,y,w,h) ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö
       { "x": 1137, "y": 171, "w": 14, "h": 38 },
       { "x": 1146, "y": 160, "w": 15, "h": 29 },
       { "x": 1159, "y": 166, "w": 15, "h": 48 },
       { "x": 1168, "y": 200, "w": 16, "h": 41 }
    ],
    // ‡∏°‡∏µ 4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ô‡∏±‡∏ö 0, 1, 2, 3) 
    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏¢‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç 3 ‡∏Ñ‡∏£‡∏±‡∏ö
    "correctIndex": 3  
  }
];

// ==========================================
// 2. ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏°
// ==========================================
const canvas = document.getElementById('quizCanvas');
const ctx = canvas.getContext('2d');
const bgImage = document.getElementById('bgImage');
const chartBox = document.getElementById('chart-box');
const gameContainer = document.getElementById('game-container');
const choiceContainer = document.getElementById('choice-container');

let currentStepIdx = 0;
let scaleRatio = 1;

window.onload = function() {
    loadStep();
    window.addEventListener('resize', resizeChart);
};

function loadStep() {
    if(currentStepIdx >= steps.length) {
        document.getElementById('end-screen').style.display = 'flex';
        return;
    }

    const s = steps[currentStepIdx];
    document.getElementById('questionText').innerText = `‡∏Ç‡πâ‡∏≠ ${currentStepIdx + 1}: ${s.question}`;
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î
    choiceContainer.innerHTML = "";
    s.choices.forEach((_, index) => {
        const btn = document.createElement("div");
        btn.className = "choice-btn";
        btn.innerText = index + 1;
        btn.onclick = () => checkAnswer(index, btn);
        choiceContainer.appendChild(btn);
    });

    bgImage.src = s.image;
    bgImage.onload = function() { resizeChart(); }
}

function resizeChart() {
    if(!bgImage.src) return;
    const containerW = gameContainer.clientWidth;
    const containerH = gameContainer.clientHeight;
    const imgW = bgImage.naturalWidth;
    const imgH = bgImage.naturalHeight;
    scaleRatio = Math.min(containerW / imgW, containerH / imgH);
    
    chartBox.style.width = (imgW * scaleRatio) + 'px';
    chartBox.style.height = (imgH * scaleRatio) + 'px';
    canvas.width = imgW;
    canvas.height = imgH;
    draw();
}

// ==========================================
// üé® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ (V6: ‡∏£‡∏∏‡πà‡∏ô‡∏Ñ‡∏≠‡∏¢‡∏≤‡∏ß ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÜ)
// ==========================================
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const s = steps[currentStepIdx];

    s.choices.forEach((box, index) => {
        const centerX = box.x + (box.w / 2);
        
        // --- ü§ñ Logic ‡πÅ‡∏¢‡∏Å‡∏ö‡∏ô‡∏•‡πà‡∏≤‡∏á ---
        const isTop = (index % 2 === 0); 
        
        // üöÄ ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á (Gap) ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å!
        // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô (Top) ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡πÄ‡∏¢‡∏≠‡∏∞‡∏´‡∏ô‡πà‡∏≠‡∏¢ (50px) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πÑ‡∏™‡πâ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÜ
        // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á (Bottom) ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 35px ‡∏Å‡πá‡∏û‡∏≠
        const gap = isTop ? 50 : 35; 
        
        let pinY;
        let targetY; 

        if (isTop) {
            targetY = box.y; 
            pinY = targetY - gap;
        } else {
            targetY = box.y + box.h;
            pinY = targetY + gap;
        }

        // 1. ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÇ‡∏¢‡∏á (‡πÄ‡∏™‡πâ‡∏ô‡∏ö‡∏≤‡∏á‡πÜ ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏ï‡∏≤)
        ctx.beginPath();
        ctx.moveTo(centerX, pinY);   
        ctx.lineTo(centerX, targetY); 
        ctx.lineWidth = 1.5;         
        ctx.strokeStyle = "#fcd535"; 
        ctx.stroke();

        // 2. ‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°
        ctx.beginPath();
        ctx.arc(centerX, pinY, 11, 0, 2 * Math.PI); // ‡∏£‡∏±‡∏®‡∏°‡∏µ 11px
        ctx.fillStyle = "#1e2329"; 
        ctx.fill();
        
        // 3. ‡∏ß‡∏≤‡∏î‡∏Ç‡∏≠‡∏ö‡∏ß‡∏á‡∏Å‡∏•‡∏°
        ctx.lineWidth = 1.5; 
        ctx.strokeStyle = "#fcd535"; 
        ctx.stroke();

        // 4. ‡∏ß‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
        ctx.fillStyle = "#fcd535"; 
        ctx.font = "bold 13px Arial"; 
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(index + 1, centerX, pinY + 1); 
    });
}

function checkAnswer(selectedIndex, btnElement) {
    const s = steps[currentStepIdx];
    
    if(selectedIndex === s.correctIndex) {
        // ‚úÖ ‡∏ñ‡∏π‡∏Å
        btnElement.classList.add("btn-correct");
        playSound(true);
        setTimeout(() => {
            currentStepIdx++;
            loadStep();
        }, 800);
    } else {
        // ‚ùå ‡∏ú‡∏¥‡∏î
        btnElement.classList.add("btn-wrong");
        playSound(false);
    }
}

function playSound(isCorrect) {
    // ‡πÉ‡∏™‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
}
</script>
</body>
</html>
